var i=Object.defineProperty;var u=(a,n,t)=>n in a?i(a,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[n]=t;var r=(a,n,t)=>(u(a,typeof n!="symbol"?n+"":n,t),t);import{a as o}from"./style.199221b6.js";function s(a){let n=localStorage.captcha||null;return n?Promise.resolve(n):new Promise(t=>grecaptcha.ready(t)).then(()=>grecaptcha.execute(o.RECAPTCHA_API_KEY,{action:a}))}const c={NEW:0,PENDING:1,SUCCESS:2,FAILURE:3},h={NEW:"NEW",SUCCESS:"SUCCESS",CANCELED:"CANCELED",FAILURE:"FAILURE"};class l{constructor(){r(this,"statusCheckTimeout",null);r(this,"refreshRequestTime",3e3);r(this,"step",0)}static goToPayment(n){return s("goToPayment").then(t=>fetch(o.API_PAYMENTS_URL.replace("{orderId}",n)+"?captcha="+t,{headers:{"Content-Type":"application/json"}})).then(t=>t.text().then(e=>({ok:t.ok,status:t.status,text:e}))).then(t=>{if(t.ok)return t;throw new Error("Payment generation link error: "+t.status+" "+t.statusText+" "+t.text)}).then(t=>{const e=JSON.parse(t.text);location.href=e.url}).catch(t=>{var e;console.error(t),(e=window.Sentry)==null||e.captureException(t),this.handleBookingError(t)})}static getPaymentStatus(n){return s("getPaymentStatus").then(t=>fetch(o.API_PAYMENTS_STATUS_URL.replace("{orderId}",n)+"?captcha="+t,{headers:{"Content-Type":"application/json"}})).then(t=>t.text().then(e=>({ok:t.ok,status:t.status,text:e}))).then(t=>{if(t.ok)return t;throw new Error("Payment error: "+t.status+" "+t.statusText+" "+t.text)}).then(t=>{const e=JSON.parse(t.text);switch(e.status){case c.NEW:case c.PENDING:this.step=h.NEW,this.statusCheckTimeout=setTimeout(this.getPaymentStatus,this.refreshRequestTime);break;case c.SUCCESS:this.step=h.SUCCESS,clearTimeout(this.statusCheckTimeout);break;case c.FAILURE:this.step=h.FAILURE,clearTimeout(this.statusCheckTimeout);break;default:console.error("Unknown payment status: ",e.status)}return this.step}).catch(t=>{var e;console.error(t),(e=window.Sentry)==null||e.captureException(t),this.handleBookingError(t)})}static cancelBooking(n){return s("cancelBooking").then(t=>fetch(o.API_PAYMENTS_CANCEL_URL.replace("{orderId}",n)+"?captcha="+t,{method:"PATCH",headers:{"Content-Type":"application/json"}})).then(t=>t.text().then(e=>({ok:t.ok,status:t.status,text:e}))).then(t=>{if(t.ok)return t;throw new Error("Cancel booking error: "+t.status+" "+t.statusText+" "+t.text)}).catch(t=>{var e;console.error(t),(e=window.Sentry)==null||e.captureException(t),this.handleBookingError(t)})}static cancelRenew(n){return s("cancelAndRenew").then(t=>fetch(o.API_PAYMENTS_CANCEL_RENEW_URL.replace("{orderId}",n)+"?captcha="+t)).then(t=>t.text().then(e=>({ok:t.ok,status:t.status,text:e}))).then(t=>{if(t.ok)return JSON.parse(t.text);throw new Error("Cancel renew order error: "+t.status+" "+t.statusText+" "+t.text)}).catch(t=>{var e;console.error(t),(e=window.Sentry)==null||e.captureException(t),this.handleBookingError(t)})}}export{l as P,h as p,s as r};
